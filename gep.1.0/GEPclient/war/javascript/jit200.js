(function(){window.$jit=function(a){var a=a||window,c;for(c in $jit)$jit[c].$extend&&(a[c]=$jit[c])};$jit.version="2.0.1";var f=function(a){return document.getElementById(a)};f.empty=function(){};f.extend=function(a,c){for(var b in c||{})a[b]=c[b];return a};f.lambda=function(a){return typeof a=="function"?a:function(){return a}};f.time=Date.now||function(){return+new Date};f.splat=function(a){var c=f.type(a);return c?c!="array"?[a]:a:[]};f.type=function(a){var c=f.type.s.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
return c!="object"?c:a&&a.$$family?a.$$family:a&&a.nodeName&&a.nodeType==1?"element":c};f.type.s=Object.prototype.toString;f.each=function(a,c){if(f.type(a)=="object")for(var b in a)c(a[b],b);else{b=0;for(var d=a.length;b<d;b++)c(a[b],b)}};f.indexOf=function(a,c){if(Array.indexOf)return a.indexOf(c);for(var b=0,d=a.length;b<d;b++)if(a[b]===c)return b;return-1};f.map=function(a,c){var b=[];f.each(a,function(a,e){b.push(c(a,e))});return b};f.reduce=function(a,c,b){var d=a.length;if(d==0)return b;for(var e=
arguments.length==3?b:a[--d];d--;)e=c(e,a[d]);return e};f.merge=function(){for(var a={},c=0,b=arguments.length;c<b;c++){var d=arguments[c];if(f.type(d)=="object")for(var e in d){var g=d[e],h=a[e];a[e]=h&&f.type(g)=="object"&&f.type(h)=="object"?f.merge(h,g):f.unlink(g)}}return a};f.unlink=function(a){var c;switch(f.type(a)){case "object":c={};for(var b in a)c[b]=f.unlink(a[b]);break;case "array":c=[];b=0;for(var d=a.length;b<d;b++)c[b]=f.unlink(a[b]);break;default:return a}return c};f.zip=function(){if(arguments.length===
0)return[];for(var a=0,c=[],b=arguments.length,d=arguments[0].length;a<d;a++){for(var e=0,g=[];e<b;e++)g.push(arguments[e][a]);c.push(g)}return c};f.rgbToHex=function(a,c){if(a.length<3)return null;if(a.length==4&&a[3]==0&&!c)return"transparent";for(var b=[],d=0;d<3;d++){var e=(a[d]-0).toString(16);b.push(e.length==1?"0"+e:e)}return c?b:"#"+b.join("")};f.hexToRgb=function(a){if(a.length!=7){a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);a.shift();if(a.length!=3)return null;for(var c=[],b=0;b<3;b++){var d=
a[b];d.length==1&&(d+=d);c.push(parseInt(d,16))}return c}else return a=parseInt(a.slice(1),16),[a>>16,a>>8&255,a&255]};f.destroy=function(a){f.clean(a);a.parentNode&&a.parentNode.removeChild(a);a.clearAttributes&&a.clearAttributes()};f.clean=function(a){for(var a=a.childNodes,c=0,b=a.length;c<b;c++)f.destroy(a[c])};f.addEvent=function(a,c,b){a.addEventListener?a.addEventListener(c,b,false):a.attachEvent("on"+c,b)};f.addEvents=function(a,c){for(var b in c)f.addEvent(a,b,c[b])};f.hasClass=function(a,
c){return(" "+a.className+" ").indexOf(" "+c+" ")>-1};f.addClass=function(a,c){if(!f.hasClass(a,c))a.className=a.className+" "+c};f.removeClass=function(a,c){a.className=a.className.replace(RegExp("(^|\\s)"+c+"(?:\\s|$)"),"$1")};f.getPos=function(a){var c=function(a){for(var d={x:0,y:0};a&&!/^(?:body|html)$/i.test(a.tagName);)d.x+=a.offsetLeft,d.y+=a.offsetTop,a=a.offsetParent;return d}(a),a=function(a){for(var d={x:0,y:0};a&&!/^(?:body|html)$/i.test(a.tagName);)d.x+=a.scrollLeft,d.y+=a.scrollTop,
a=a.parentNode;return d}(a);return{x:c.x-a.x,y:c.y-a.y}};f.event={get:function(a,c){return a||(c||window).event},getWheel:function(a){return a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3},isRightClick:function(a){return a.which==3||a.button==2},getPos:function(a,c){var c=c||window,a=a||c.event,b=c.document,b=b.documentElement||b.body;a.touches&&a.touches.length&&(a=a.touches[0]);return{x:a.pageX||a.clientX+b.scrollLeft,y:a.pageY||a.clientY+b.scrollTop}},stop:function(a){a.stopPropagation&&a.stopPropagation();
a.cancelBubble=true;a.preventDefault?a.preventDefault():a.returnValue=false}};$jit.util=$jit.id=f;var m=function(a){var a=a||{},c=function(){for(var a in this)typeof this[a]!="function"&&(this[a]=f.unlink(this[a]));this.constructor=c;if(m.prototyping)return this;a=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return a},b;for(b in m.Mutators)a[b]&&(a=m.Mutators[b](a,a[b]),delete a[b]);f.extend(c,this);c.constructor=m;c.prototype=a;return c};m.Mutators={Implements:function(a,
c){f.each(f.splat(c),function(c){m.prototyping=c;var c=typeof c=="function"?new c:c,d;for(d in c)d in a||(a[d]=c[d]);delete m.prototyping});return a}};f.extend(m,{inherit:function(a,c){for(var b in c){var d=c[b],e=a[b],g=f.type(d);e&&g=="function"?d!=e&&m.override(a,b,d):a[b]=g=="object"?f.merge(e,d):d}return a},override:function(a,c,b){var d=m.prototyping;d&&a[c]!=d[c]&&(d=null);a[c]=function(){var e=this.parent;this.parent=d?d[c]:a[c];var g=b.apply(this,arguments);this.parent=e;return g}}});m.prototype.implement=
function(){var a=this.prototype;f.each(Array.prototype.slice.call(arguments||[]),function(c){m.inherit(a,c)});return this};$jit.Class=m;$jit.json={prune:function(a,c){this.each(a,function(a,d){if(d==c&&a.children)delete a.children,a.children=[]})},getParent:function(a,c){if(a.id==c)return false;var b=a.children;if(b&&b.length>0)for(var d=0;d<b.length;d++)if(b[d].id==c)return a;else{var e=this.getParent(b[d],c);if(e)return e}return false},getSubtree:function(a,c){if(a.id==c)return a;for(var b=0,d=
a.children;d&&b<d.length;b++){var e=this.getSubtree(d[b],c);if(e!=null)return e}return null},eachLevel:function(a,c,b,d){if(c<=b&&(d(a,c),a.children))for(var e=0,a=a.children;e<a.length;e++)this.eachLevel(a[e],c+1,b,d)},each:function(a,c){this.eachLevel(a,0,Number.MAX_VALUE,c)}};$jit.Trans={$extend:true,linear:function(a){return a}};var y=$jit.Trans;(function(){var a=function(a,b){b=f.splat(b);return f.extend(a,{easeIn:function(d){return a(d,b)},easeOut:function(d){return 1-a(1-d,b)},easeInOut:function(d){return d<=
0.5?a(2*d,b)/2:(2-a(2*(1-d),b))/2}})};f.each({Pow:function(a,b){return Math.pow(a,b[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){b=b[0]||1.618;return Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,d=0,e=1;;d+=e,e/=2)if(a>=(7-4*d)/11){b=e*e-Math.pow((11-6*d-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/
3)}},function(c,b){y[b]=a(c)});f.each(["Quad","Cubic","Quart","Quint"],function(c,b){y[c]=a(function(a){return Math.pow(a,[b+2])})})})();var A=new m({initialize:function(a){this.setOptions(a)},setOptions:function(a){this.opt=f.merge({duration:2500,fps:40,transition:y.Quart.easeInOut,compute:f.empty,complete:f.empty,link:"ignore"},a||{});return this},step:function(){var a=f.time(),c=this.opt;a<this.time+c.duration?(a=c.transition((a-this.time)/c.duration),c.compute(a)):(this.timer=clearInterval(this.timer),
c.compute(1),c.complete())},start:function(){if(!this.check())return this;this.time=0;this.startTimer();return this},startTimer:function(){var a=this,c=this.opt.fps;if(this.timer)return false;this.time=f.time()-this.time;this.timer=setInterval(function(){a.step()},Math.round(1E3/c));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return false;this.time=f.time()-this.time;this.timer=clearInterval(this.timer);
return true},check:function(){if(!this.timer)return true;return this.opt.link=="cancel"?(this.stopTimer(),true):false}}),s=function(){for(var a=arguments,c=0,b=a.length,d={};c<b;c++){var e=s[a[c]];e.$extend?f.extend(d,e):d[a[c]]=e}return d};s.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[0.5,0.3,0.1]}}}};s.Tree={$extend:true,
orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};s.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};s.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};s.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,
clearCanvas:true};s.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};s.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:f.empty,onHide:f.empty};s.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};s.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:f.empty,onRightClick:f.empty,onMouseMove:f.empty,onMouseEnter:f.empty,
onMouseLeave:f.empty,onDragStart:f.empty,onDragMove:f.empty,onDragCancel:f.empty,onDragEnd:f.empty,onTouchStart:f.empty,onTouchMove:f.empty,onTouchEnd:f.empty,onMouseWheel:f.empty};s.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};s.Controller={$extend:true,onBeforeCompute:f.empty,onAfterCompute:f.empty,onCreateLabel:f.empty,onPlaceLabel:f.empty,onComplete:f.empty,onBeforePlotLine:f.empty,onAfterPlotLine:f.empty,onBeforePlotNode:f.empty,onAfterPlotNode:f.empty,request:false};
var B={initialize:function(a,c){this.viz=c;this.canvas=c.canvas;this.config=c.config[a];this.nodeTypes=c.fx.nodeTypes;var b=this.config.type;this.labelContainer=(this.dom=b=="auto"?c.config.Label.type!="Native":b!="Native")&&c.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:f.empty,setAsProperty:f.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(a,c,b){var a=f.event.get(a,c),c=this.labelContainer,d=a.target||a.srcElement,a=a.relatedTarget;
return b?a&&a==this.viz.canvas.getCtx().canvas&&!!d&&this.isDescendantOf(d,c):this.isDescendantOf(d,c)},isDescendantOf:function(a,c){for(;a&&a.parentNode;){if(a.parentNode==c)return a;a=a.parentNode}return false}},C={onMouseUp:f.empty,onMouseDown:f.empty,onMouseMove:f.empty,onMouseOver:f.empty,onMouseOut:f.empty,onMouseWheel:f.empty,onTouchStart:f.empty,onTouchMove:f.empty,onTouchEnd:f.empty,onTouchCancel:f.empty},I=new m({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.edge=this.node=
false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var a=this.canvas.getElement(),c=this;a.oncontextmenu=f.lambda(false);f.addEvents(a,{mouseup:function(a,b){var g=f.event.get(a,b);c.handleEvent("MouseUp",a,b,c.makeEventObject(a,b),f.event.isRightClick(g))},mousedown:function(a,b){var g=f.event.get(a,b);c.handleEvent("MouseDown",a,b,c.makeEventObject(a,b),f.event.isRightClick(g))},mousemove:function(a,b){c.handleEvent("MouseMove",a,b,c.makeEventObject(a,b))},mouseover:function(a,
b){c.handleEvent("MouseOver",a,b,c.makeEventObject(a,b))},mouseout:function(a,b){c.handleEvent("MouseOut",a,b,c.makeEventObject(a,b))},touchstart:function(a,b){c.handleEvent("TouchStart",a,b,c.makeEventObject(a,b))},touchmove:function(a,b){c.handleEvent("TouchMove",a,b,c.makeEventObject(a,b))},touchend:function(a,b){c.handleEvent("TouchEnd",a,b,c.makeEventObject(a,b))}});var b=function(a,b){var g=f.event.get(a,b),g=f.event.getWheel(g);c.handleEvent("MouseWheel",a,b,g)};!document.getBoxObjectFor&&
window.mozInnerScreenX==null?f.addEvent(a,"mousewheel",b):a.addEventListener("DOMMouseScroll",b,false)},register:function(a){this.registeredObjects.push(a)},handleEvent:function(){for(var a=Array.prototype.slice.call(arguments),c=a.shift(),b=0,d=this.registeredObjects,e=d.length;b<e;b++)d[b]["on"+c].apply(d[b],a)},makeEventObject:function(a,c){var b=this,d=this.viz.graph,e=this.viz.fx,g=e.nodeTypes,h=e.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,
getPos:function(){var d=b.viz.canvas,e=d.getSize(),g=d.getPos(),h=d.translateOffsetX,o=d.translateOffsetY,q=d.scaleOffsetX,d=d.scaleOffsetY,t=f.event.getPos(a,c);return this.pos={x:(t.x-g.x-e.width/2-h)*1/q,y:(t.y-g.y-e.height/2-o)*1/d}},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=true;for(var a in d.nodes){var c=d.nodes[a],h=c&&g[c.getData("type")];if(h=h&&h.contains&&h.contains.call(e,c,this.getPos()))return this.contains=h,b.node=this.node=c}return b.node=this.node=
false},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=true;var a={},c;for(c in d.edges){var g=d.edges[c];a[c]=true;for(var f in g)if(!(f in a)){var o=g[f],q=o&&h[o.getData("type")];if(q=q&&q.contains&&q.contains.call(e,o,this.getPos()))return this.contains=q,b.edge=this.edge=o}}return b.edge=this.edge=false},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}}),x={initializeExtras:function(){var a=new I(this),c=this;
f.each(["NodeStyles","Tips","Navigation","Events"],function(b){var d=new x.Classes[b](b,c);d.isEnabled()&&a.register(d);d.setAsProperty()&&(c[b.toLowerCase()]=d)})},Classes:{}};x.Classes.Events=new m({Implements:[B,C],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.moved=this.touchMoved=this.touched=this.pressed=this.hovered=false},setAsProperty:f.lambda(true),onMouseUp:function(a,c,b,d){a=f.event.get(a,c);if(!this.moved)if(d)this.config.onRightClick(this.hovered,
b,a);else this.config.onClick(this.pressed,b,a);if(this.pressed){if(this.moved)this.config.onDragEnd(this.pressed,b,a);else this.config.onDragCancel(this.pressed,b,a);this.pressed=this.moved=false}},onMouseOut:function(a,c,b){var d=f.event.get(a,c),e;if(this.dom&&(e=this.isLabel(a,c,true)))this.config.onMouseLeave(this.viz.graph.getNode(e.id),b,d),this.hovered=false;else{a=d.relatedTarget;for(c=this.canvas.getElement();a&&a.parentNode;){if(c==a.parentNode)return;a=a.parentNode}if(this.hovered)this.config.onMouseLeave(this.hovered,
b,d),this.hovered=false}},onMouseOver:function(a,c,b){var d=f.event.get(a,c),e;if(this.dom&&(e=this.isLabel(a,c,true)))this.hovered=this.viz.graph.getNode(e.id),this.config.onMouseEnter(this.hovered,b,d)},onMouseMove:function(a,c,b){a=f.event.get(a,c);if(this.pressed)this.moved=true,this.config.onDragMove(this.pressed,b,a);else if(this.dom)this.config.onMouseMove(this.hovered,b,a);else{if(this.hovered){var c=this.hovered,d=c.nodeFrom?this.etypes[c.getData("type")]:this.ntypes[c.getData("type")];if(d&&
d.contains&&d.contains.call(this.fx,c,b.getPos())){this.config.onMouseMove(c,b,a);return}else this.config.onMouseLeave(c,b,a),this.hovered=false}if(this.hovered=b.getNode()||this.config.enableForEdges&&b.getEdge())this.config.onMouseEnter(this.hovered,b,a);else this.config.onMouseMove(false,b,a)}},onMouseWheel:function(a,c,b){this.config.onMouseWheel(b,f.event.get(a,c))},onMouseDown:function(a,c,b){var d=f.event.get(a,c);if(this.dom){if(a=this.isLabel(a,c))this.pressed=this.viz.graph.getNode(a.id)}else this.pressed=
b.getNode()||this.config.enableForEdges&&b.getEdge();this.pressed&&this.config.onDragStart(this.pressed,b,d)},onTouchStart:function(a,c,b){var d=f.event.get(a,c),e;(this.touched=this.dom&&(e=this.isLabel(a,c))?this.viz.graph.getNode(e.id):b.getNode()||this.config.enableForEdges&&b.getEdge())&&this.config.onTouchStart(this.touched,b,d)},onTouchMove:function(a,c,b){a=f.event.get(a,c);if(this.touched)this.touchMoved=true,this.config.onTouchMove(this.touched,b,a)},onTouchEnd:function(a,c,b){a=f.event.get(a,
c);if(this.touched){if(this.touchMoved)this.config.onTouchEnd(this.touched,b,a);else this.config.onTouchCancel(this.touched,b,a);this.touched=this.touchMoved=false}}});x.Classes.Tips=new m({Implements:[B,C],initializePost:function(){if(document.body){var a=f("_tooltip")||document.createElement("div");a.id="_tooltip";a.className="tip";f.extend(a.style,{position:"absolute",display:"none",zIndex:13E6});document.body.appendChild(a);this.tip=a;this.node=false}},setAsProperty:f.lambda(true),onMouseOut:function(a,
c){f.event.get(a,c);if(this.dom&&this.isLabel(a,c,true))this.hide(true);else{for(var b=a.relatedTarget,d=this.canvas.getElement();b&&b.parentNode;){if(d==b.parentNode)return;b=b.parentNode}this.hide(false)}},onMouseOver:function(a,c){var b;if(this.dom&&(b=this.isLabel(a,c,false)))this.node=this.viz.graph.getNode(b.id),this.config.onShow(this.tip,this.node,b)},onMouseMove:function(a,c,b){this.dom&&this.isLabel(a,c)&&this.setTooltipPosition(f.event.getPos(a,c));if(!this.dom){var d=b.getNode();if(d){if(this.config.force||
!this.node||this.node.id!=d.id)this.node=d,this.config.onShow(this.tip,d,b.getContains());this.setTooltipPosition(f.event.getPos(a,c))}else this.hide(true)}},setTooltipPosition:function(a){var c=this.tip,b=c.style,d=this.config;b.display="";var e=document.body.clientWidth,g=c.offsetWidth,c=c.offsetHeight,h=d.offsetX,d=d.offsetY;b.top=(a.y+d+c>document.body.clientHeight?a.y-c-d:a.y+d)+"px";b.left=(a.x+g+h>e?a.x-g-h:a.x+h)+"px"},hide:function(a){this.tip.style.display="none";a&&this.config.onHide()}});
x.Classes.NodeStyles=new m({Implements:[B,C],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new A;this.move=this.down=false},onMouseOut:function(a,c){this.down=this.move=false;if(this.hoveredNode){this.dom&&this.isLabel(a,c,true)&&this.toggleStylesOnHover(this.hoveredNode,false);for(var b=a.relatedTarget,
d=this.canvas.getElement();b&&b.parentNode;){if(d==b.parentNode)return;b=b.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false}},onMouseOver:function(a,c){var b;if(this.dom&&(b=this.isLabel(a,c,true)))if(b=this.viz.graph.getNode(b.id),!b.selected)this.hoveredNode=b,this.toggleStylesOnHover(this.hoveredNode,true)},onMouseDown:function(a,c,b,d){if(!d){var e;if(this.dom&&(e=this.isLabel(a,c)))this.down=this.viz.graph.getNode(e.id);else if(!this.dom)this.down=b.getNode();
this.move=false}},onMouseUp:function(a,c,b,d){if(!d){if(!this.move)this.onClick(b.getNode());this.down=this.move=false}},getRestoredStyles:function(a,c){var b={},d=this["nodeStylesOn"+c],e;for(e in d)b[e]=a.styles["$"+e];return b},toggleStylesOnHover:function(a,c){this.nodeStylesOnHover&&this.toggleStylesOn("Hover",a,c)},toggleStylesOnClick:function(a,c){this.nodeStylesOnClick&&this.toggleStylesOn("Click",a,c)},toggleStylesOn:function(a,c,b){var d=this.viz;if(b){if(!c.styles)c.styles=f.merge(c.data,
{});for(var e in this["nodeStylesOn"+a])b="$"+e,b in c.styles||(c.styles[b]=c.getData(e));d.fx.nodeFx(f.extend({elements:{id:c.id,properties:this["nodeStylesOn"+a]},transition:y.Quart.easeOut,duration:300,fps:40},this.config))}else a=this.getRestoredStyles(c,a),d.fx.nodeFx(f.extend({elements:{id:c.id,properties:a},transition:y.Quart.easeOut,duration:300,fps:40},this.config))},onClick:function(a){if(a){var c=this.nodeStylesOnClick;if(c)a.selected?(this.toggleStylesOnClick(a,false),delete a.selected):
(this.viz.graph.eachNode(function(a){if(a.selected){for(var d in c)a.setData(d,a.styles["$"+d],"end");delete a.selected}}),this.toggleStylesOnClick(a,true),a.selected=true,delete a.hovered,this.hoveredNode=false)}},onMouseMove:function(a,c,b){if(this.down)this.move=true;if(!this.dom||!this.isLabel(a,c)){var d=this.nodeStylesOnHover;if(d&&!this.dom){if(this.hoveredNode&&(a=this.types[this.hoveredNode.getData("type")])&&a.contains&&a.contains.call(this.fx,this.hoveredNode,b.getPos()))return;b=b.getNode();
if((this.hoveredNode||b)&&!b.hovered)if(b&&!b.selected)this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(a){if(a.hovered&&!a.selected){for(var b in d)a.setData(b,a.styles["$"+b],"end");delete a.hovered}}),b.hovered=true,this.hoveredNode=b,this.toggleStylesOnHover(b,true);else if(this.hoveredNode&&!this.hoveredNode.selected)this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,false),delete this.hoveredNode.hovered,this.hoveredNode=false}}}});x.Classes.Navigation=
new m({Implements:[B,C],initializePost:function(){this.pressed=this.pos=false},onMouseWheel:function(a,c,b){this.config.zooming&&(f.event.stop(f.event.get(a,c)),a=1+b*(this.config.zooming/1E3),this.canvas.scale(a,a))},onMouseDown:function(a,c,b){if(this.config.panning&&!(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(a,c):b.getNode()))){this.pressed=true;this.pos=b.getPos();var a=this.canvas,c=a.translateOffsetX,b=a.translateOffsetY,d=a.scaleOffsetY;this.pos.x*=a.scaleOffsetX;this.pos.x+=
c;this.pos.y*=d;this.pos.y+=b}},onMouseMove:function(a,c,b){if(this.config.panning&&this.pressed&&!(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(a,c):b.getNode()))){var a=this.pos,b=b.getPos(),d=this.canvas,e=d.translateOffsetX,g=d.translateOffsetY,c=d.scaleOffsetX,d=d.scaleOffsetY;b.x*=c;b.y*=d;b.x+=e;b.y+=g;e=b.x-a.x;a=b.y-a.y;this.pos=b;this.canvas.translate(e*1/c,a*1/d)}},onMouseUp:function(){if(this.config.panning)this.pressed=false}});var v;(function(){function a(a,c){var g=document.createElement(a),
h;for(h in c)typeof c[h]=="object"?f.extend(g[h],c[h]):g[h]=c[h];a=="canvas"&&!b&&G_vmlCanvasManager&&(g=G_vmlCanvasManager.initElement(document.body.appendChild(g)));return g}var c=typeof HTMLCanvasElement,b=c=="object"||c=="function";$jit.Canvas=v=new m({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(d,b){this.viz=d;this.opt=this.config=b;var c=f.type(b.injectInto)=="string"?b.injectInto:b.injectInto.id,
h=b.type,j=c+"-label",i=f(c),k=b.width||i.offsetWidth,l=b.height||i.offsetHeight;this.id=c;var o={injectInto:c,width:k,height:l};this.element=a("div",{id:c+"-canvaswidget",style:{position:"relative",width:k+"px",height:l+"px"}});this.labelContainer=this.createLabelContainer(b.Label.type,j,o);this.canvases.push(new v.Base[h]({config:f.extend({idSuffix:"-canvas"},o),plot:function(){d.fx.plot()},resize:function(){d.refresh()}}));if(c=b.background)o=new v.Background[c.type](d,f.extend(c,o)),this.canvases.push(new v.Base[h](o));
for(h=this.canvases.length;h--;)this.element.appendChild(this.canvases[h].canvas),h>0&&this.canvases[h].plot();this.element.appendChild(this.labelContainer);i.appendChild(this.element);var q=null,t=this;f.addEvent(window,"scroll",function(){clearTimeout(q);q=setTimeout(function(){t.getPos(true)},500)})},getCtx:function(a){return this.canvases[a||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(a){return this.canvases[a||0].getSize()},resize:function(a,
b){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var c=0,h=this.canvases.length;c<h;c++)this.canvases[c].resize(a,b);c=this.element.style;c.width=a+"px";c.height=b+"px";if(this.labelContainer)this.labelContainer.style.width=a+"px"},translate:function(a,b,c){this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=b*this.scaleOffsetY;for(var h=0,f=this.canvases.length;h<f;h++)this.canvases[h].translate(a,b,c)},scale:function(a,b){var c=
this.scaleOffsetX*a,h=this.scaleOffsetY*b,f=this.translateOffsetX*(a-1)/c,i=this.translateOffsetY*(b-1)/h;this.scaleOffsetX=c;this.scaleOffsetY=h;c=0;for(h=this.canvases.length;c<h;c++)this.canvases[c].scale(a,b,true);this.translate(f,i,false)},getPos:function(a){return a||!this.pos?this.pos=f.getPos(this.getElement()):this.pos},clear:function(a){this.canvases[a||0].clear()},path:function(a,b){var c=this.canvases[0].getCtx();c.beginPath();b(c);c[a]();c.closePath()},createLabelContainer:function(d,
b,c){if(d=="HTML"||d=="Native")return a("div",{id:b,style:{overflow:"visible",position:"absolute",top:0,left:0,width:c.width+"px",height:0}});else if(d=="SVG"){d=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");d.setAttribute("width",c.width);d.setAttribute("height",c.height);var h=d.style;h.position="absolute";h.left=h.top="0px";h=document.createElementNS("http://www.w3.org/2000/svg","svg:g");h.setAttribute("width",c.width);h.setAttribute("height",c.height);h.setAttribute("x",0);
h.setAttribute("y",0);h.setAttribute("id",b);d.appendChild(h);return d}}});v.Base={};v.Base["2D"]=new m({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(a){this.viz=a;this.opt=a.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var d=this.opt,b=d.width,c=d.height;this.canvas=a("canvas",{id:d.injectInto+d.idSuffix,width:b,height:c,style:{position:"absolute",top:0,left:0,width:b+"px",height:c+"px"}})},getCtx:function(){return!this.ctx?
this.ctx=this.canvas.getContext("2d"):this.ctx},getSize:function(){if(this.size)return this.size;var a=this.canvas;return this.size={width:a.width,height:a.height}},translateToCenter:function(a){var b=this.getSize(),c=a?b.width-a.width-this.translateOffsetX*2:b.width;height=a?b.height-a.height-this.translateOffsetY*2:b.height;b=this.getCtx();a&&b.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);b.translate(c/2,height/2)},resize:function(a,c){var g=this.getSize(),h=this.canvas,f=h.style;this.size=false;
h.width=a;h.height=c;f.width=a+"px";f.height=c+"px";b?this.translateToCenter():this.translateToCenter(g);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(a,c,this)},translate:function(a,b,c){var h=this.scaleOffsetY;this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=b*h;this.getCtx().translate(a,b);!c&&this.plot()},scale:function(a,b,c){this.scaleOffsetX*=a;this.scaleOffsetY*=b;this.getCtx().scale(a,b);!c&&this.plot()},
clear:function(){var a=this.getSize(),b=this.translateOffsetX,c=this.translateOffsetY,h=this.scaleOffsetX,f=this.scaleOffsetY;this.getCtx().clearRect((-a.width/2-b)*1/h,(-a.height/2-c)*1/f,a.width*1/h,a.height*1/f)},plot:function(){this.clear();this.viz.plot(this)}});v.Background={};v.Background.Circles=new m({initialize:function(a,b){this.viz=a;this.config=f.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},b)},resize:function(a,b,c){this.plot(c)},plot:function(a){var a=
a.getCtx(),b=this.config,c=b.CanvasStyles,h;for(h in c)a[h]=c[h];h=b.numberOfCircles;b=b.levelDistance;for(c=1;c<=h;c++)a.beginPath(),a.arc(0,0,b*c,0,2*Math.PI,false),a.stroke(),a.closePath()}})})();var u=function(a,c){this.theta=a||0;this.rho=c||0};$jit.Polar=u;u.prototype={getc:function(a){return this.toComplex(a)},getp:function(){return this},set:function(a){a=a.getp();this.theta=a.theta;this.rho=a.rho},setc:function(a,c){this.rho=Math.sqrt(a*a+c*c);this.theta=Math.atan2(c,a);this.theta<0&&(this.theta+=
Math.PI*2)},setp:function(a,c){this.theta=a;this.rho=c},clone:function(){return new u(this.theta,this.rho)},toComplex:function(a){var c=Math.cos(this.theta)*this.rho,b=Math.sin(this.theta)*this.rho;return a?{x:c,y:b}:new p(c,b)},add:function(a){return new u(this.theta+a.theta,this.rho+a.rho)},scale:function(a){return new u(this.theta,this.rho*a)},equals:function(a){return this.theta==a.theta&&this.rho==a.rho},$add:function(a){this.theta+=a.theta;this.rho+=a.rho;return this},$madd:function(a){this.theta=
(this.theta+a.theta)%(Math.PI*2);this.rho+=a.rho;return this},$scale:function(a){this.rho*=a;return this},isZero:function(){var a=Math.abs;return a(this.theta)<1.0E-4&&a(this.rho)<1.0E-4},interpolate:function(a,c){var b=Math.PI,d=b*2,e=function(a){return a<0?a%d+d:a%d},g=this.theta,h=a.theta,f=Math.abs(g-h);return{theta:f==b?g>h?e(h+(g-d-h)*c):e(h-d+(g-h)*c):f>=b?g>h?e(h+(g-d-h)*c):e(h-d+(g-(h-d))*c):e(h+(g-h)*c),rho:(this.rho-a.rho)*c+a.rho}}};u.KER=new u(0,0);var p=function(a,c){this.x=a||0;this.y=
c||0};$jit.Complex=p;p.prototype={getc:function(){return this},getp:function(a){return this.toPolar(a)},set:function(a){a=a.getc(true);this.x=a.x;this.y=a.y},setc:function(a,c){this.x=a;this.y=c},setp:function(a,c){this.x=Math.cos(a)*c;this.y=Math.sin(a)*c},clone:function(){return new p(this.x,this.y)},toPolar:function(a){var c=this.norm(),b=Math.atan2(this.y,this.x);b<0&&(b+=Math.PI*2);return a?{theta:b,rho:c}:new u(b,c)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*
this.x+this.y*this.y},add:function(a){return new p(this.x+a.x,this.y+a.y)},prod:function(a){return new p(this.x*a.x-this.y*a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new p(this.x,-this.y)},scale:function(a){return new p(this.x*a,this.y*a)},equals:function(a){return this.x==a.x&&this.y==a.y},$add:function(a){this.x+=a.x;this.y+=a.y;return this},$prod:function(a){var c=this.x,b=this.y;this.x=c*a.x-b*a.y;this.y=b*a.x+c*a.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(a){this.x*=
a;this.y*=a;return this},$div:function(a){var c=this.x,b=this.y,d=a.squaredNorm();this.x=c*a.x+b*a.y;this.y=b*a.x-c*a.y;return this.$scale(1/d)},isZero:function(){var a=Math.abs;return a(this.x)<1.0E-4&&a(this.y)<1.0E-4}};p.KER=new p(0,0);$jit.Graph=new m({initialize:function(a,c,b,d){var e={klass:p,Node:{}};this.Node=c;this.Edge=b;this.Label=d;this.opt=f.merge(e,a||{});this.nodes={};this.edges={};var g=this;this.nodeList={};for(var h in D)g.nodeList[h]=function(a){return function(){var d=Array.prototype.slice.call(arguments);
g.eachNode(function(b){b[a].apply(b,d)})}}(h)},getNode:function(a){return this.hasNode(a)?this.nodes[a]:false},get:function(a){return this.getNode(a)},getByName:function(a){for(var c in this.nodes){var b=this.nodes[c];if(b.name==a)return b}return false},getAdjacence:function(a,c){return a in this.edges?this.edges[a][c]:false},addNode:function(a){if(!this.nodes[a.id]){var c=this.edges[a.id]={};this.nodes[a.id]=new n.Node(f.extend({id:a.id,name:a.name,data:f.merge(a.data||{},{}),adjacencies:c},this.opt.Node),
this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[a.id]},addAdjacence:function(a,c,b){this.hasNode(a.id)||this.addNode(a);this.hasNode(c.id)||this.addNode(c);a=this.nodes[a.id];c=this.nodes[c.id];if(!a.adjacentTo(c)){var d=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[c.id]=this.edges[c.id]||{};d[c.id]=e[a.id]=new n.Adjacence(a,c,b,this.Edge,this.Label);return d[c.id]}return this.edges[a.id][c.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var c=this.edges[a],
b;for(b in c)delete this.edges[b][a];delete this.edges[a]}},removeAdjacence:function(a,c){delete this.edges[a][c];delete this.edges[c][a]},hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={};this.edges={}}});var n=$jit.Graph,D;(function(){var a=function(a,b,c,h,f){var i,c=c||"current";if(c=="current")i=this.data;else if(c=="start")i=this.startData;else if(c=="end")i=this.endData;a="$"+(a?a+"-":"")+b;return h?i[a]:!this.Config.overridable?f[b]||0:a in i?i[a]:a in this.data?this.data[a]:
f[b]||0},c=function(a,b,c,h){var h=h||"current",f;if(h=="current")f=this.data;else if(h=="start")f=this.startData;else if(h=="end")f=this.endData;f["$"+(a?a+"-":"")+b]=c},b=function(a,b){var a="$"+(a?a+"-":""),c=this;f.each(b,function(b){b=a+b;delete c.data[b];delete c.endData[b];delete c.startData[b]})};D={getData:function(b,c,g){return a.call(this,"",b,c,g,this.Config)},setData:function(a,b,g){c.call(this,"",a,b,g)},setDataset:function(a,b){var a=f.splat(a),c;for(c in b)for(var h=0,j=f.splat(b[c]),
i=a.length;h<i;h++)this.setData(c,j[h],a[h])},removeData:function(){b.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(b,c,g){return a.call(this,"canvas",b,c,g,this.Config.CanvasStyles)},setCanvasStyle:function(a,b,g){c.call(this,"canvas",a,b,g)},setCanvasStyles:function(a,b){var a=f.splat(a),c;for(c in b)for(var h=0,j=f.splat(b[c]),i=a.length;h<i;h++)this.setCanvasStyle(c,j[h],a[h])},removeCanvasStyle:function(){b.call(this,"canvas",Array.prototype.slice.call(arguments))},
getLabelData:function(b,c,g){return a.call(this,"label",b,c,g,this.Label)},setLabelData:function(a,b,g){c.call(this,"label",a,b,g)},setLabelDataset:function(a,b){var a=f.splat(a),c;for(c in b)for(var h=0,j=f.splat(b[c]),i=a.length;h<i;h++)this.setLabelData(c,j[h],a[h])},removeLabelData:function(){b.call(this,"label",Array.prototype.slice.call(arguments))}}})();n.Node=new m({initialize:function(a,c,b,d,e){c={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,
angleSpan:{begin:0,end:0},pos:new c,startPos:new c,endPos:new c};f.extend(this,f.extend(c,a));this.Config=this.Node=b;this.Edge=d;this.Label=e},adjacentTo:function(a){return a.id in this.adjacencies},getAdjacency:function(a){return this.adjacencies[a]},getPos:function(a){a=a||"current";if(a=="current")return this.pos;else if(a=="end")return this.endPos;else if(a=="start")return this.startPos},setPos:function(a,c){var c=c||"current",b;if(c=="current")b=this.pos;else if(c=="end")b=this.endPos;else if(c==
"start")b=this.startPos;b.set(a)}});n.Node.implement(D);n.Adjacence=new m({initialize:function(a,c,b,d,e){this.nodeFrom=a;this.nodeTo=c;this.data=b||{};this.startData={};this.endData={};this.Config=this.Edge=d;this.Label=e}});n.Adjacence.implement(D);n.Util={filter:function(a){if(!a||f.type(a)!="string")return function(){return true};var c=a.split(" ");return function(a){for(var d=0;d<c.length;d++)if(a[c[d]])return false;return true}},getNode:function(a,c){return a.nodes[c]},eachNode:function(a,c,
b){var b=this.filter(b),d;for(d in a.nodes)b(a.nodes[d])&&c(a.nodes[d])},each:function(a,c,b){this.eachNode(a,c,b)},eachAdjacency:function(a,c,b){var d=a.adjacencies,b=this.filter(b),e;for(e in d){var g=d[e];if(b(g)){if(g.nodeFrom!=a){var h=g.nodeFrom;g.nodeFrom=g.nodeTo;g.nodeTo=h}c(g,e)}}},computeLevels:function(a,c,b,d){var b=b||0,e=this.filter(d);this.eachNode(a,function(a){a._flag=false;a._depth=-1},d);a=a.getNode(c);a._depth=b;for(var g=[a];g.length!=0;){var h=g.pop();h._flag=true;this.eachAdjacency(h,
function(a){a=a.nodeTo;if(a._flag==false&&e(a)){if(a._depth<0)a._depth=h._depth+1+b;g.unshift(a)}},d)}},eachBFS:function(a,c,b,d){var e=this.filter(d);this.clean(a);for(var g=[a.getNode(c)];g.length!=0;)a=g.pop(),a._flag=true,b(a,a._depth),this.eachAdjacency(a,function(a){a=a.nodeTo;if(a._flag==false&&e(a))a._flag=true,g.unshift(a)},d)},eachLevel:function(a,c,b,d,e){var g=a._depth,h=this.filter(e),f=this,b=b===false?Number.MAX_VALUE-g:b;(function k(a,b,c){var e=a._depth;e>=b&&e<=c&&h(a)&&d(a,e);e<
c&&f.eachAdjacency(a,function(a){a=a.nodeTo;a._depth>e&&k(a,b,c)})})(a,c+g,b+g)},eachSubgraph:function(a,c,b){this.eachLevel(a,0,false,c,b)},eachSubnode:function(a,c,b){this.eachLevel(a,1,1,c,b)},anySubnode:function(a,c,b){var d=false,c=c||f.lambda(true),e=f.type(c)=="string"?function(a){return a[c]}:c;this.eachSubnode(a,function(a){e(a)&&(d=true)},b);return d},getSubnodes:function(a,c,b){var d=[],c=c||0,e;f.type(c)=="array"?(e=c[0],c=c[1]):(e=c,c=Number.MAX_VALUE-a._depth);this.eachLevel(a,e,c,function(a){d.push(a)},
b);return d},getParents:function(a){var c=[];this.eachAdjacency(a,function(b){b=b.nodeTo;b._depth<a._depth&&c.push(b)});return c},isDescendantOf:function(a,c){if(a.id==c)return true;for(var b=this.getParents(a),d=false,e=0;!d&&e<b.length;e++)d=d||this.isDescendantOf(b[e],c);return d},clean:function(a){this.eachNode(a,function(a){a._flag=false})},getClosestNodeToOrigin:function(a,c,b){return this.getClosestNodeToPos(a,u.KER,c,b)},getClosestNodeToPos:function(a,c,b,d){var e=null,b=b||"current",c=c&&
c.getc(true)||p.KER,g=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};this.eachNode(a,function(a){e=e==null||g(a.getPos(b).getc(true),c)<g(e.getPos(b).getc(true),c)?a:e},d);return e}};f.each("get,getNode,each,eachNode,computeLevels,eachBFS,clean,getClosestNodeToPos,getClosestNodeToOrigin".split(","),function(a){n.prototype[a]=function(){return n.Util[a].apply(n.Util,[this].concat(Array.prototype.slice.call(arguments)))}});f.each("eachAdjacency,eachLevel,eachSubgraph,eachSubnode,anySubnode,getSubnodes,getParents,isDescendantOf".split(","),
function(a){n.Node.prototype[a]=function(){return n.Util[a].apply(n.Util,[this].concat(Array.prototype.slice.call(arguments)))}});n.Op={options:{type:"nothing",duration:2E3,hideLabels:true,fps:30},initialize:function(a){this.viz=a},removeNode:function(a,c){var b=this.viz,d=f.merge(this.options,b.controller,c),e=f.splat(a),g,h,j;switch(d.type){case "nothing":for(g=0;g<e.length;g++)b.graph.removeNode(e[g]);break;case "replot":this.removeNode(e,{type:"nothing"});b.labels.clearLabels();b.refresh(true);
break;case "fade:seq":case "fade":h=this;for(g=0;g<e.length;g++)j=b.graph.getNode(e[g]),j.setData("alpha",0,"end");b.fx.animate(f.merge(d,{modes:["node-property:alpha"],onComplete:function(){h.removeNode(e,{type:"nothing"});b.labels.clearLabels();b.reposition();b.fx.animate(f.merge(d,{modes:["linear"]}))}}));break;case "fade:con":h=this;for(g=0;g<e.length;g++)j=b.graph.getNode(e[g]),j.setData("alpha",0,"end"),j.ignore=true;b.reposition();b.fx.animate(f.merge(d,{modes:["node-property:alpha","linear"],
onComplete:function(){h.removeNode(e,{type:"nothing"});d.onComplete&&d.onComplete()}}));break;case "iter":h=this;b.fx.sequence({condition:function(){return e.length!=0},step:function(){h.removeNode(e.shift(),{type:"nothing"});b.labels.clearLabels()},onComplete:function(){d.onComplete&&d.onComplete()},duration:Math.ceil(d.duration/e.length)});break;default:this.doError()}},removeEdge:function(a,c){var b=this.viz,d=f.merge(this.options,b.controller,c),e=f.type(a[0])=="string"?[a]:a,g,h,j;switch(d.type){case "nothing":for(g=
0;g<e.length;g++)b.graph.removeAdjacence(e[g][0],e[g][1]);break;case "replot":this.removeEdge(e,{type:"nothing"});b.refresh(true);break;case "fade:seq":case "fade":h=this;for(g=0;g<e.length;g++)(j=b.graph.getAdjacence(e[g][0],e[g][1]))&&j.setData("alpha",0,"end");b.fx.animate(f.merge(d,{modes:["edge-property:alpha"],onComplete:function(){h.removeEdge(e,{type:"nothing"});b.reposition();b.fx.animate(f.merge(d,{modes:["linear"]}))}}));break;case "fade:con":h=this;for(g=0;g<e.length;g++)if(j=b.graph.getAdjacence(e[g][0],
e[g][1]))j.setData("alpha",0,"end"),j.ignore=true;b.reposition();b.fx.animate(f.merge(d,{modes:["edge-property:alpha","linear"],onComplete:function(){h.removeEdge(e,{type:"nothing"});d.onComplete&&d.onComplete()}}));break;case "iter":h=this;b.fx.sequence({condition:function(){return e.length!=0},step:function(){h.removeEdge(e.shift(),{type:"nothing"});b.labels.clearLabels()},onComplete:function(){d.onComplete()},duration:Math.ceil(d.duration/e.length)});break;default:this.doError()}},sum:function(a,
c){var b=this.viz,d=f.merge(this.options,b.controller,c),e=b.root,g;b.root=c.id||b.root;switch(d.type){case "nothing":g=b.construct(a);g.eachNode(function(a){a.eachAdjacency(function(a){b.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data)})});break;case "replot":b.refresh(true);this.sum(a,{type:"nothing"});b.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=this;g=b.construct(a);var h=!this.preprocessSum(g)?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];b.reposition();
d.type!="fade:con"?b.fx.animate(f.merge(d,{modes:["linear"],onComplete:function(){b.fx.animate(f.merge(d,{modes:h,onComplete:function(){d.onComplete()}}))}})):(b.graph.eachNode(function(a){a.id!=e&&a.pos.isZero()&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))}),b.fx.animate(f.merge(d,{modes:["linear"].concat(h)})));break;default:this.doError()}},morph:function(a,c,b){var b=b||{},d=this.viz,e=f.merge(this.options,d.controller,c),g=d.root,h;d.root=c.id||d.root;switch(e.type){case "nothing":h=d.construct(a);
h.eachNode(function(a){var b=d.graph.hasNode(a.id);a.eachAdjacency(function(a){var b=!!d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);d.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data);if(b){var b=d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id),c;for(c in a.data||{})b.data[c]=a.data[c]}});if(b){var b=d.graph.getNode(a.id),c;for(c in a.data||{})b.data[c]=a.data[c]}});d.graph.eachNode(function(a){a.eachAdjacency(function(a){h.getAdjacence(a.nodeFrom.id,a.nodeTo.id)||d.graph.removeAdjacence(a.nodeFrom.id,
a.nodeTo.id)});h.hasNode(a.id)||d.graph.removeNode(a.id)});break;case "replot":d.labels.clearLabels(true);this.morph(a,{type:"nothing"});d.refresh(true);d.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=this;h=d.construct(a);var j="node-property"in b&&f.map(f.splat(b["node-property"]),function(a){return"$"+a});d.graph.eachNode(function(a){var b=h.getNode(a.id);if(b){var b=b.data,c;for(c in b)j&&f.indexOf(j,c)>-1?a.endData[c]=b[c]:a.data[c]=b[c]}else a.setData("alpha",1),a.setData("alpha",
1,"start"),a.setData("alpha",0,"end"),a.ignore=true});d.graph.eachNode(function(a){a.ignore||a.eachAdjacency(function(a){if(!a.nodeFrom.ignore&&!a.nodeTo.ignore){var b=h.getNode(a.nodeFrom.id),a=h.getNode(a.nodeTo.id);b.adjacentTo(a)||(a=d.graph.getAdjacence(b.id,a.id),i=true,a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"))}})});var i=this.preprocessSum(h),a=!i?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];a[0]+="node-property"in b?":"+f.splat(b["node-property"]).join(":"):
"";a[1]=(a[1]||"edge-property:alpha")+("edge-property"in b?":"+f.splat(b["edge-property"]).join(":"):"");"label-property"in b&&a.push("label-property:"+f.splat(b["label-property"]).join(":"));d.reposition?d.reposition():d.compute("end");d.graph.eachNode(function(a){a.id!=g&&a.pos.getp().equals(u.KER)&&(a.pos.set(a.endPos),a.startPos.set(a.endPos))});d.fx.animate(f.merge(e,{modes:[b.position||"polar"].concat(a),onComplete:function(){d.graph.eachNode(function(a){a.ignore&&d.graph.removeNode(a.id)});
d.graph.eachNode(function(a){a.eachAdjacency(function(a){a.ignore&&d.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})});e.onComplete()}}))}},contract:function(a,c){var b=this.viz;if(!a.collapsed&&a.anySubnode(f.lambda(true)))c=f.merge(this.options,b.config,c||{},{modes:["node-property:alpha:span","linear"]}),a.collapsed=true,function e(a){a.eachSubnode(function(a){a.ignore=true;a.setData("alpha",0,c.type=="animate"?"end":"current");e(a)})}(a),c.type=="animate"?(b.compute("end"),b.rotated&&b.rotate(b.rotated,
"none",{property:"end"}),function g(b){b.eachSubnode(function(b){b.setPos(a.getPos("end"),"end");g(b)})}(a),b.fx.animate(c)):c.type=="replot"&&b.refresh()},expand:function(a,c){if("collapsed"in a){var b=this.viz,c=f.merge(this.options,b.config,c||{},{modes:["node-property:alpha:span","linear"]});delete a.collapsed;(function e(a){a.eachSubnode(function(a){delete a.ignore;a.setData("alpha",1,c.type=="animate"?"end":"current");e(a)})})(a);c.type=="animate"?(b.compute("end"),b.rotated&&b.rotate(b.rotated,
"none",{property:"end"}),b.fx.animate(c)):c.type=="replot"&&b.refresh()}},preprocessSum:function(a){var c=this.viz;a.eachNode(function(a){c.graph.hasNode(a.id)||(c.graph.addNode(a),a=c.graph.getNode(a.id),a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end"))});var b=false;a.eachNode(function(a){a.eachAdjacency(function(a){var d=c.graph.getNode(a.nodeFrom.id),h=c.graph.getNode(a.nodeTo.id);d.adjacentTo(h)||(a=c.graph.addAdjacence(d,h,a.data),d.startAlpha==d.endAlpha&&h.startAlpha==
h.endAlpha&&(b=true,a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end")))})});return b}};var F={none:{render:f.empty,contains:f.lambda(false)},circle:{render:function(a,c,b,d){d=d.getCtx();d.beginPath();d.arc(c.x,c.y,b,0,Math.PI*2,true);d.closePath();d[a]()},contains:function(a,c,b){var d=a.x-c.x,a=a.y-c.y;return d*d+a*a<=b*b}},ellipse:{render:function(a,c,b,d,e){var e=e.getCtx(),g=1,h=1,f=1,i=1,k=0;b>d?(k=b/2,h=d/b,i=b/d):(k=d/2,g=b/d,f=d/b);e.save();e.scale(g,h);e.beginPath();
e.arc(c.x*f,c.y*i,k,0,Math.PI*2,true);e.closePath();e[a]();e.restore()},contains:function(a,c,b,d){var e=0,g=1,h=1,f=0,i=0,e=0;b>d?(e=b/2,h=d/b):(e=d/2,g=b/d);f=(a.x-c.x)*(1/g);i=(a.y-c.y)*(1/h);return f*f+i*i<=e*e}},square:{render:function(a,c,b,d){d.getCtx()[a+"Rect"](c.x-b,c.y-b,2*b,2*b)},contains:function(a,c,b){return Math.abs(c.x-a.x)<=b&&Math.abs(c.y-a.y)<=b}},rectangle:{render:function(a,c,b,d,e){e.getCtx()[a+"Rect"](c.x-b/2,c.y-d/2,b,d)},contains:function(a,c,b,d){return Math.abs(c.x-a.x)<=
b/2&&Math.abs(c.y-a.y)<=d/2}},triangle:{render:function(a,c,b,d){var d=d.getCtx(),e=c.x,g=c.y-b,h=e-b,c=c.y+b,b=e+b;d.beginPath();d.moveTo(e,g);d.lineTo(h,c);d.lineTo(b,c);d.closePath();d[a]()},contains:function(a,c,b){return F.circle.contains(a,c,b)}},star:{render:function(a,c,b,d){var d=d.getCtx(),e=Math.PI/5;d.save();d.translate(c.x,c.y);d.beginPath();d.moveTo(b,0);for(c=0;c<9;c++)d.rotate(e),c%2==0?d.lineTo(b/0.525731*0.200811,0):d.lineTo(b,0);d.closePath();d[a]();d.restore()},contains:function(a,
c,b){return F.circle.contains(a,c,b)}}},G={line:{render:function(a,c,b){b=b.getCtx();b.beginPath();b.moveTo(a.x,a.y);b.lineTo(c.x,c.y);b.stroke()},contains:function(a,c,b,d){var e=Math.min,g=Math.max,h=e(a.x,c.x),f=g(a.x,c.x),e=e(a.y,c.y),g=g(a.y,c.y);return b.x>=h&&b.x<=f&&b.y>=e&&b.y<=g?Math.abs(c.x-a.x)<=d?true:Math.abs((c.y-a.y)/(c.x-a.x)*(b.x-a.x)+a.y-b.y)<=d:false}},arrow:{render:function(a,c,b,d,e){e=e.getCtx();d&&(d=a,a=c,c=d);d=new p(c.x-a.x,c.y-a.y);d.$scale(b/d.norm());var b=new p(c.x-
d.x,c.y-d.y),g=new p(-d.y/2,d.x/2),d=b.add(g),b=b.$add(g.$scale(-1));e.beginPath();e.moveTo(a.x,a.y);e.lineTo(c.x,c.y);e.stroke();e.beginPath();e.moveTo(d.x,d.y);e.lineTo(b.x,b.y);e.lineTo(c.x,c.y);e.closePath();e.fill()},contains:function(a,c,b,d){return G.line.contains(a,c,b,d)}},hyperline:{render:function(a,c,b,d){function e(a,b){return a<b?a+Math.PI>b?false:true:b+Math.PI>a?true:false}var d=d.getCtx(),g=function(a,b){var c=a.x*b.y-a.y*b.x,d=a.squaredNorm(),e=b.squaredNorm();if(c==0)return{x:0,
y:0,ratio:-1};var g=(a.y*e-b.y*d+a.y-b.y)/c,c=(b.x*d-a.x*e+b.x-a.x)/c,d=-g/2,e=-c/2,f=(g*g+c*c)/4-1;if(f<0)return{x:0,y:0,ratio:-1};f=Math.sqrt(f);return{x:d,y:e,ratio:f>1E3?-1:f,a:g,b:c}}(a,c);g.a>1E3||g.b>1E3||g.ratio<0?(d.beginPath(),d.moveTo(a.x*b,a.y*b),d.lineTo(c.x*b,c.y*b)):(c=Math.atan2(c.y-g.y,c.x-g.x),a=Math.atan2(a.y-g.y,a.x-g.x),e=e(c,a),d.beginPath(),d.arc(g.x*b,g.y*b,g.ratio*b,c,a,e));d.stroke()},contains:f.lambda(false)}};n.Plot={initialize:function(a,c){this.viz=a;this.config=a.config;
this.node=a.config.Node;this.edge=a.config.Edge;this.animation=new A;this.nodeTypes=new c.Plot.NodeTypes;this.edgeTypes=new c.Plot.EdgeTypes;this.labels=a.labels},nodeHelper:F,edgeHelper:G,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",
shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(a,c,b){return a+(c-a)*b},moebius:function(a,c,b,d){c=d.scale(-b);if(c.norm()<1){var b=c.x,d=c.y,e=a.startPos.getc().moebiusTransformation(c);a.pos.setc(e.x,e.y);c.x=b;c.y=d}},linear:function(a,c,b){var c=a.startPos.getc(true),d=a.endPos.getc(true);a.pos.setc(this.compute(c.x,d.x,b),this.compute(c.y,d.y,b))},polar:function(a,c,b){c=a.startPos.getp(true);b=a.endPos.getp().interpolate(c,
b);a.pos.setp(b.theta,b.rho)},number:function(a,c,b,d,e){var g=a[d](c,"start"),d=a[d](c,"end");a[e](c,this.compute(g,d,b))},color:function(a,c,b,d,e){var g=f.hexToRgb(a[d](c,"start")),d=f.hexToRgb(a[d](c,"end")),h=this.compute,b=f.rgbToHex([parseInt(h(g[0],d[0],b)),parseInt(h(g[1],d[1],b)),parseInt(h(g[2],d[2],b))]);a[e](c,b)},"array-number":function(a,c,b,d,e){for(var g=a[d](c,"start"),d=a[d](c,"end"),h=[],f=0,i=g.length;f<i;f++){var k=g[f],l=d[f];if(k.length){for(var o=0,q=k.length,t=[];o<q;o++)t.push(this.compute(k[o],
l[o],b));h.push(t)}else h.push(this.compute(k,l,b))}a[e](c,h)},node:function(a,c,b,d,e,g){d=this[d];if(c)for(var h=c.length,f=0;f<h;f++){var i=c[f];this[d[i]](a,i,b,e,g)}else for(i in d)this[d[i]](a,i,b,e,g)},edge:function(a,c,b,d,e,g){var a=a.adjacencies,h;for(h in a)this.node(a[h],c,b,d,e,g)},"node-property":function(a,c,b){this.node(a,c,b,"map","getData","setData")},"edge-property":function(a,c,b){this.edge(a,c,b,"map","getData","setData")},"label-property":function(a,c,b){this.node(a,c,b,"label",
"getLabelData","setLabelData")},"node-style":function(a,c,b){this.node(a,c,b,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(a,c,b){this.edge(a,c,b,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(a){var c=this,a=f.merge({condition:f.lambda(false),step:f.empty,onComplete:f.empty,duration:200},a||{}),b=setInterval(function(){a.condition()?a.step():(clearInterval(b),a.onComplete());c.viz.refresh(true)},a.duration)},prepare:function(a){var c=this.viz.graph,b={"node-property":{getter:"getData",
setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},d={};if(f.type(a)=="array")for(var e=0,g=a.length;e<g;e++){var h=a[e].split(":");d[h.shift()]=h}else for(e in a)e=="position"?d[a.position]=[]:d[e]=f.splat(a[e]);c.eachNode(function(a){a.startPos.set(a.pos);f.each(["node-property","node-style"],function(c){if(c in d)for(var e=d[c],g=0,h=e.length;g<h;g++)a[b[c].setter](e[g],
a[b[c].getter](e[g]),"start")});f.each(["edge-property","edge-style"],function(c){if(c in d){var e=d[c];a.eachAdjacency(function(a){for(var d=0,g=e.length;d<g;d++)a[b[c].setter](e[d],a[b[c].getter](e[d]),"start")})}})});return d},animate:function(a,c){var a=f.merge(this.viz.config,a||{}),b=this,d=this.viz.graph,e=this.Interpolator,g=a.type==="nodefx"?this.nodeFxAnimation:this.animation,h=this.prepare(a.modes);a.hideLabels&&this.labels.hideLabels(true);g.setOptions(f.extend(a,{$animating:false,compute:function(g){d.eachNode(function(a){for(var b in h)e[b](a,
h[b],g,c)});b.plot(a,this.$animating,g);this.$animating=true},complete:function(){a.hideLabels&&b.labels.hideLabels(false);b.plot(a);a.onComplete()}})).start()},nodeFx:function(a){var c=this.viz,b=c.graph,d=this.nodeFxAnimation,e=f.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false}),a=f.merge(e,a||{},{onBeforeCompute:f.empty,onAfterCompute:f.empty});d.stopTimer();var g=a.elements.properties;a.elements.id?(d=f.splat(a.elements.id),f.each(d,function(a){if(a=b.getNode(a))for(var c in g)a.setData(c,
g[c],"end")})):b.eachNode(function(a){for(var b in g)a.setData(b,g[b],"end")});var d=[],h;for(h in g)d.push(h);h=["node-property:"+d.join(":")];a.reposition&&(h.push("linear"),c.compute("end"));this.animate(f.merge(a,{modes:h,type:"nodefx"}))},plot:function(a,c){var b=this.viz,d=b.graph,e=b.canvas,b=b.root,g=this;e.getCtx();a=a||this.viz.controller;a.clearCanvas&&e.clear();if(b=d.getNode(b)){var h=!!b.visited;d.eachNode(function(b){var d=b.getData("alpha");b.eachAdjacency(function(d){var f=d.nodeTo;
!!f.visited===h&&b.drawn&&f.drawn&&(!c&&a.onBeforePlotLine(d),g.plotLine(d,e,c),!c&&a.onAfterPlotLine(d))});b.drawn&&(!c&&a.onBeforePlotNode(b),g.plotNode(b,e,c),!c&&a.onAfterPlotNode(b));!g.labelsHidden&&a.withLabels&&(b.drawn&&d>=0.95?g.labels.plotLabel(e,b,a):g.labels.hideLabel(b,false));b.visited=!h})}},plotTree:function(a,c,b){var d=this,e=this.viz.canvas;e.getCtx();var g=a.getData("alpha");a.eachSubnode(function(g){if(c.plotSubtree(a,g)&&g.exist&&g.drawn){var f=a.getAdjacency(g.id);!b&&c.onBeforePlotLine(f);
d.plotLine(f,e,b);!b&&c.onAfterPlotLine(f);d.plotTree(g,c,b)}});a.drawn?(!b&&c.onBeforePlotNode(a),this.plotNode(a,e,b),!b&&c.onAfterPlotNode(a),!c.hideLabels&&c.withLabels&&g>=0.95?this.labels.plotLabel(e,a,c):this.labels.hideLabel(a,false)):this.labels.hideLabel(a,true)},plotNode:function(a,c,b){var d=a.getData("type"),e=this.node.CanvasStyles;if(d!="none"){var g=a.getData("lineWidth"),h=a.getData("color"),f=a.getData("alpha"),i=c.getCtx();i.save();i.lineWidth=g;i.fillStyle=i.strokeStyle=h;i.globalAlpha=
f;for(var k in e)i[k]=a.getCanvasStyle(k);this.nodeTypes[d].render.call(this,a,c,b);i.restore()}},plotLine:function(a,c,b){var d=a.getData("type"),e=this.edge.CanvasStyles;if(d!="none"){var g=a.getData("lineWidth"),h=a.getData("color"),f=c.getCtx(),i=a.nodeFrom,k=a.nodeTo;f.save();f.lineWidth=g;f.fillStyle=f.strokeStyle=h;f.globalAlpha=Math.min(i.getData("alpha"),k.getData("alpha"),a.getData("alpha"));for(var l in e)f[l]=a.getCanvasStyle(l);this.edgeTypes[d].render.call(this,a,c,b);f.restore()}}};
n.Plot3D=f.merge(n.Plot,{Interpolator:{linear:function(a,c,b){var c=a.startPos.getc(true),d=a.endPos.getc(true);a.pos.setc(this.compute(c.x,d.x,b),this.compute(c.y,d.y,b),this.compute(c.z,d.z,b))}},plotNode:function(a,c){a.getData("type")!="none"&&this.plotElement(a,c,{getAlpha:function(){return a.getData("alpha")}})},plotLine:function(a,c){a.getData("type")!="none"&&this.plotElement(a,c,{getAlpha:function(){return Math.min(a.nodeFrom.getData("alpha"),a.nodeTo.getData("alpha"),a.getData("alpha"))}})},
plotElement:function(a,c,b){var d=c.getCtx(),e=new Matrix4,g=c.config.Scene.Lighting,h=c.canvases[0],c=h.program,h=h.camera;if(!a.geometry)a.geometry=new (O3D[a.getData("type")]);a.geometry.update(a);if(!a.webGLVertexBuffer){for(var j=[],i=[],k=[],l=0,o=a.geometry,q=0,t=o.vertices,o=o.faces,J=o.length;q<J;q++){var r=o[q],m=t[r.a],n=t[r.b],z=t[r.c],w=r.d?t[r.d]:false,r=r.normal;j.push(m.x,m.y,m.z);j.push(n.x,n.y,n.z);j.push(z.x,z.y,z.z);w&&j.push(w.x,w.y,w.z);k.push(r.x,r.y,r.z);k.push(r.x,r.y,r.z);
k.push(r.x,r.y,r.z);w&&k.push(r.x,r.y,r.z);i.push(l,l+1,l+2);w?(i.push(l,l+2,l+3),l+=4):l+=3}a.webGLVertexBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array(j),d.STATIC_DRAW);a.webGLFaceBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),d.STATIC_DRAW);a.webGLFaceCount=i.length;a.webGLNormalBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);
d.bufferData(d.ARRAY_BUFFER,new Float32Array(k),d.STATIC_DRAW)}e.multiply(h.matrix,a.geometry.matrix);d.uniformMatrix4fv(c.viewMatrix,false,e.flatten());d.uniformMatrix4fv(c.projectionMatrix,false,h.projectionMatrix.flatten());e=Matrix4.makeInvert(e);e.$transpose();d.uniformMatrix4fv(c.normalMatrix,false,e.flatten());e=f.hexToRgb(a.getData("color"));e.push(b.getAlpha());d.uniform4f(c.color,e[0]/255,e[1]/255,e[2]/255,e[3]);d.uniform1i(c.enableLighting,g.enable);if(g.enable){if(g.ambient)b=g.ambient,
d.uniform3f(c.ambientColor,b[0],b[1],b[2]);if(g.directional)g=g.directional,e=g.color,g=g.direction,g=(new Vector3(g.x,g.y,g.z)).normalize().$scale(-1),d.uniform3f(c.lightingDirection,g.x,g.y,g.z),d.uniform3f(c.directionalColor,e[0],e[1],e[2])}d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.vertexAttribPointer(c.position,3,d.FLOAT,false,0,0);d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);d.vertexAttribPointer(c.normal,3,d.FLOAT,false,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);
d.drawElements(d.TRIANGLES,a.webGLFaceCount,d.UNSIGNED_SHORT,0)}});n.Label={};n.Label.Native=new m({initialize:function(a){this.viz=a},plotLabel:function(a,c,b){var d=a.getCtx();c.pos.getc(true);d.font=c.getLabelData("style")+" "+c.getLabelData("size")+"px "+c.getLabelData("family");d.textAlign=c.getLabelData("textAlign");d.fillStyle=d.strokeStyle=c.getLabelData("color");d.textBaseline=c.getLabelData("textBaseline");this.renderLabel(a,c,b)},renderLabel:function(a,c){var b=a.getCtx(),d=c.pos.getc(true);
b.fillText(c.name,d.x,d.y+c.getData("height")/2)},hideLabel:f.empty,hideLabels:f.empty});n.Label.DOM=new m({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(a){return a in this.labels&&this.labels[a]!=null?this.labels[a]:this.labels[a]=document.getElementById(a)},hideLabels:function(a){this.getLabelContainer().style.display=a?"none":
"";this.labelsHidden=a},clearLabels:function(a){for(var c in this.labels)if(a||!this.viz.graph.hasNode(c))this.disposeLabel(c),delete this.labels[c]},disposeLabel:function(a){(a=this.getLabel(a))&&a.parentNode&&a.parentNode.removeChild(a)},hideLabel:function(a,c){var a=f.splat(a),b=c?"":"none",d=this;f.each(a,function(a){if(a=d.getLabel(a.id))a.style.display=b})},fitsInCanvas:function(a,c){var b=c.getSize();return a.x>=b.width||a.x<0||a.y>=b.height||a.y<0?false:true}});n.Label.HTML=new m({Implements:n.Label.DOM,
plotLabel:function(a,c,b){var a=c.id,d=this.getLabel(a);if(!d&&!(d=document.getElementById(a))){var d=document.createElement("div"),e=this.getLabelContainer();d.id=a;d.className="node";d.style.position="absolute";b.onCreateLabel(d,c);e.appendChild(d);this.labels[c.id]=d}this.placeLabel(d,c,b)}});n.Label.SVG=new m({Implements:n.Label.DOM,plotLabel:function(a,c,b){var a=c.id,d=this.getLabel(a);if(!d&&!(d=document.getElementById(a))){var d=document.createElementNS("http://www.w3.org/2000/svg","svg:text"),
e=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");d.appendChild(e);e=this.getLabelContainer();d.setAttribute("id",a);d.setAttribute("class","node");e.appendChild(d);b.onCreateLabel(d,c);this.labels[c.id]=d}this.placeLabel(d,c,b)}});n.Geom=new m({initialize:function(a){this.viz=a;this.config=a.config;this.node=a.config.Node;this.edge=a.config.Edge},translate:function(a,c){c=f.splat(c);this.viz.graph.eachNode(function(b){f.each(c,function(c){b.getPos(c).$add(a)})})},setRightLevelToShow:function(a,
c,b){var d=this.getRightLevelToShow(a,c),e=this.viz.labels,g=f.merge({execShow:true,execHide:true,onHide:f.empty,onShow:f.empty},b||{});a.eachLevel(0,this.config.levelsToShow,function(b){if(b._depth-a._depth>d){if(g.onHide(b),g.execHide)b.drawn=false,b.exist=false,e.hideLabel(b,false)}else if(g.onShow(b),g.execShow)b.exist=true});a.drawn=true},getRightLevelToShow:function(a,c){var b=this.config,d=b.levelsToShow;if(!b.constrained)return d;for(;!this.treeFitsInCanvas(a,c,d)&&d>1;)d--;return d}});var K=
{construct:function(a){var c=f.type(a)=="array",b=new n(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);c?function(a,b){for(var c=function(c){for(var g=0,h=b.length;g<h;g++)if(b[g].id==c)return b[g];return a.addNode({id:c,name:c})},h=0,j=b.length;h<j;h++){a.addNode(b[h]);var i=b[h].adjacencies;if(i)for(var k=0,l=i.length;k<l;k++){var o=i[k],q={};if(typeof i[k]!="string")q=f.merge(o.data,{}),o=o.nodeTo;a.addAdjacence(b[h],c(o),q)}}}(b,a):function(a,b){a.addNode(b);if(b.children)for(var c=
0,h=b.children;c<h.length;c++)a.addAdjacence(b,h[c]),arguments.callee(a,h[c])}(b,a);return b},loadJSON:function(a,c){this.json=a;this.labels&&this.labels.clearLabels&&this.labels.clearLabels(true);this.graph=this.construct(a);this.root=f.type(a)!="array"?a.id:a[c?c:0].id},toJSON:function(a){if((a||"tree")=="tree")var c={},c=function e(a){var b={};b.id=a.id;b.name=a.name;b.data=a.data;var c=[];a.eachSubnode(function(a){c.push(e(a))});b.children=c;return b}(this.graph.getNode(this.root));else{var c=
[],b=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(a){var g={};g.id=a.id;g.name=a.name;g.data=a.data;var h=[];a.eachAdjacency(function(a){var c=a.nodeTo;if(!!c.visited===b){var e={};e.nodeTo=c.id;e.data=a.data;h.push(e)}});g.adjacencies=h;c.push(g);a.visited=!b})}return c}},H=$jit.Layouts={},L={label:null,compute:function(a,c,b){this.initializeLabel(b);var d=this.label,e=d.style;a.eachNode(function(a){var b=a.getData("autoWidth"),c=a.getData("autoHeight");if(b||c){delete a.data.$width;
delete a.data.$height;delete a.data.$dim;var i=a.getData("width"),k=a.getData("height");e.width=b?"auto":i+"px";e.height=c?"auto":k+"px";d.innerHTML=a.name;b=d.offsetWidth;c=d.offsetHeight;i=a.getData("type");f.indexOf(["circle","square","triangle","star"],i)===-1?(a.setData("width",b),a.setData("height",c)):(b=b>c?b:c,a.setData("width",b),a.setData("height",b),a.setData("dim",b))}})},initializeLabel:function(a){if(!this.label)this.label=document.createElement("div"),document.body.appendChild(this.label);
this.setLabelStyles(a)},setLabelStyles:function(){f.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};H.Tree=function(){function a(a,b,c,d,e){var g=b.Node,h=b.multitree;if(g.overridable){var f=-1,i=-1;a.eachNode(function(a){if(a._depth==c&&(!h||"$orn"in a.data&&a.data.$orn==d)){var b=a.getData("width",e),a=a.getData("height",e);f=f<b?b:f;i=i<a?a:i}});return{width:f<0?g.width:f,height:i<0?g.height:i}}else return g}
function c(a,b,c,d){a.getPos(b)[d=="left"||d=="right"?"y":"x"]+=c}function b(a,b){var c=[];f.each(a,function(a){a=l.call(a);a[0]+=b;a[1]+=b;c.push(a)});return c}function d(a,b){if(a.length==0)return b;if(b.length==0)return a;var c=a.shift(),e=b.shift();return[[c[0],e[1]]].concat(d(a,b))}function e(a,b){b=b||[];if(a.length==0)return b;var c=a.pop();return e(a,d(c,b))}function g(a,b,c,d,e){if(a.length<=e||b.length<=e)return 0;var h=a[e][1],f=b[e][0];return Math.max(g(a,b,c,d,++e)+c,h-f+d)}function h(a,
c,e){function h(a,f,i){if(f.length<=i)return[];var j=f[i],k=g(a,j,c,e,0);return[k].concat(h(d(a,b(j,k)),f,++i))}return h([],a,0)}function j(a,c,e){function h(a,f,i){if(f.length<=i)return[];var j=f[i],k=-g(j,a,c,e,0);return[k].concat(h(d(b(j,k),a),f,++i))}a=l.call(a);return h([],a.reverse(),0).reverse()}function i(a,b,c,d){var e=h(a,b,c),a=j(a,b,c);d=="left"?a=e:d=="right"&&(e=a);d=0;for(b=[];d<e.length;d++)b[d]=(e[d]+a[d])/2;return b}function k(d,g,h,f,j){function k(g,m,q){var n=g.getData(v,h),p=
[],w=[],z=false,D=(m||g.getData(x,h))+f.levelDistance;g.eachSubnode(function(b){if(b.exist&&(!l||"$orn"in b.data&&b.data.$orn==j))z||(z=a(d,f,b._depth,j,h)),b=k(b,z[x],q+D),p.push(b.tree),w.push(b.extent)});for(var m=i(w,B,y,C),E=0,A=[];E<p.length;E++)c(p[E],h,m[E],j),A.push(b(w[E],m[E]));n=[[-n/2,n/2]].concat(e(A));g.getPos(h)[s]=0;j=="top"||j=="left"?g.getPos(h)[u]=q:g.getPos(h)[u]=-q;return{tree:g,extent:n}}var l=f.multitree,m=["x","y"],n=["width","height"],p=+(j=="left"||j=="right"),s=m[p],u=
m[1-p],v=n[p],x=n[1-p],y=f.siblingOffset,B=f.subtreeOffset,C=f.align;k(g,false,0)}var l=Array.prototype.slice;return new m({compute:function(a,b){var c=a||"start",d=this.graph.getNode(this.root);f.extend(d,{drawn:true,exist:true,selected:true});L.compute(this.graph,c,this.config);(b||!("_depth"in d))&&this.graph.computeLevels(this.root,0,"ignore");this.computePositions(d,c)},computePositions:function(a,b){var c=this.config,d=c.multitree,e=c.align,g=e!=="center"&&c.indent,c=c.orientation,h=this;f.each(d?
["top","right","bottom","left"]:[c],function(c){k(h.graph,a,b,h.config,c,b);var f=["x","y"][+(c=="left"||c=="right")];(function M(a){a.eachSubnode(function(h){if(h.exist&&(!d||"$orn"in h.data&&h.data.$orn==c))h.getPos(b)[f]+=a.getPos(b)[f],g&&(h.getPos(b)[f]+=e=="left"?g:-g),M(h)})})(a)})}})}();$jit.ST=function(){function a(a){a=a||this.clickedNode;if(!this.config.constrained)return[];var c=this.geom,g=this.canvas,h=a._depth,f=[];this.graph.eachNode(function(b){b.exist&&!b.selected&&(b.isDescendantOf(a.id)?
b._depth<=h&&f.push(b):f.push(b))});c=c.getRightLevelToShow(a,g);a.eachLevel(c,c,function(a){a.exist&&!a.selected&&f.push(a)});for(c=0;c<b.length;c++)g=this.graph.getNode(b[c]),g.isDescendantOf(a.id)||f.push(g);return f}function c(){var a=[],b=this.config;this.clickedNode.eachLevel(0,b.levelsToShow,function(c){b.multitree&&!("$orn"in c.data)&&c.anySubnode(function(a){return a.exist&&!a.drawn})?a.push(c):c.drawn&&!c.anySubnode("drawn")&&a.push(c)});return a}var b=[];return new m({Implements:[K,x,H.Tree],
initialize:function(a){var b=$jit.ST,a=this.controller=this.config=f.merge(s("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=f.merge({type:"Circles"},a.background);this.canvas=new v(this,a);this.config.labelContainer=
(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:p};this.graph=new n(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new b.Label[a.Label.type](this);this.fx=new b.Plot(this,b);this.op=new b.Op(this);this.group=new b.Group(this);this.geom=new b.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(a,b,c){var f=this.geom,j=this.fx,i=this;if(!j.busy)j.busy=true,this.contract({onComplete:function(){f.switchOrientation(a);
i.compute("end",false);j.busy=false;if(b=="animate")i.onClick(i.clickedNode.id,c);else b=="replot"&&i.select(i.clickedNode.id,c)}},a)},switchAlignment:function(a,b,c){this.config.align=a;if(b=="animate")this.select(this.clickedNode.id,c);else if(b=="replot")this.onClick(this.clickedNode.id,c)},addNodeInPath:function(a){b.push(a);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(){b.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();
this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(a){if(a.exist)a.drawn=true});this.compute("end")},requestNodes:function(a,b){var c=f.merge(this.controller,b),h=this.config.levelsToShow;if(c.request){var j=[],i=a._depth;a.eachLevel(0,h,function(a){if(a.drawn&&!a.anySubnode())j.push(a),a._level=h-(a._depth-i)});this.group.requestNodes(j,
c)}else c.onComplete()},contract:function(b,c){var g=this.config.orientation,h=this.geom,j=this.group;c&&h.switchOrientation(c);var i=a.call(this);c&&h.switchOrientation(g);j.contract(i,f.merge(this.controller,b))},move:function(a,b){this.compute("end",false);var c=b.Move,h={x:c.offsetX,y:c.offsetY};c.enable&&this.geom.translate(a.endPos.add(h).$scale(-1),"end");this.fx.animate(f.merge(this.controller,{modes:["linear"]},b))},expand:function(a,b){this.group.expand(c.call(this,a),f.merge(this.controller,
b))},selectPath:function(a){function c(a){if(!(a==null||a.selected))a.selected=true,f.each(g.group.getSiblings([a])[a.id],function(a){a.exist=true;a.drawn=true}),a=a.getParents(),a=a.length>0?a[0]:null,c(a)}var g=this;this.graph.eachNode(function(a){a.selected=false});for(var h=0,a=[a.id].concat(b);h<a.length;h++)c(this.graph.getNode(a[h]))},setRoot:function(a,b,c){function f(){if(this.config.multitree&&l.data.$orn){var b={left:"right",right:"left",top:"bottom",bottom:"top"}[l.data.$orn];k.data.$orn=
b;(function t(c){c.eachSubnode(function(c){if(c.id!=a)c.data.$orn=b,t(c)})})(k);delete l.data.$orn}this.root=a;this.clickedNode=l;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(l,i,{execHide:false,onShow:function(a){if(!a.drawn)a.drawn=true,a.setData("alpha",1,"end"),a.setData("alpha",0),a.pos.setc(l.pos.x,l.pos.y)}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){j.busy=false;j.onClick(a,{onComplete:function(){c&&
c.onComplete()}})}})}if(!this.busy){this.busy=true;var j=this,i=this.canvas,k=this.graph.getNode(this.root),l=this.graph.getNode(a);delete k.data.$orns;b=="animate"?(f.call(this),j.selectPath(l)):b=="replot"&&(f.call(this),this.select(this.root))}},addSubtree:function(a,b,c){b=="replot"?this.op.sum(a,f.extend({type:"replot"},c||{})):b=="animate"&&this.op.sum(a,f.extend({type:"fade:seq"},c||{}))},removeSubtree:function(a,b,c,h){var j=[];this.graph.getNode(a).eachLevel(+!b,false,function(a){j.push(a.id)});
c=="replot"?this.op.removeNode(j,f.extend({type:"replot"},h||{})):c=="animate"&&this.op.removeNode(j,f.extend({type:"fade:seq"},h||{}))},select:function(b,e){var g=this.group,h=this.geom,j=this.graph.getNode(b),i=this.canvas;this.graph.getNode(this.root);var k=f.merge(this.controller,e),l=this;k.onBeforeCompute(j);this.selectPath(j);this.clickedNode=j;this.requestNodes(j,{onComplete:function(){g.hide(g.prepare(a.call(l)),k);h.setRightLevelToShow(j,i);l.compute("current");l.graph.eachNode(function(a){var b=
a.pos.getc(true);a.startPos.setc(b.x,b.y);a.endPos.setc(b.x,b.y);a.visited=false});l.geom.translate(j.endPos.add({x:k.offsetX,y:k.offsetY}).$scale(-1),["start","current","end"]);g.show(c.call(l));l.plot();k.onAfterCompute(l.clickedNode);k.onComplete()}})},onClick:function(a,b){var c=this.canvas,h=this,j=this.geom,i=this.config,k=f.merge(this.controller,{Move:{enable:true,offsetX:i.offsetX||0,offsetY:i.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:f.empty,onBeforeContract:f.empty,onBeforeMove:f.empty,
onBeforeExpand:f.empty},b);if(!this.busy){this.busy=true;var l=this.graph.getNode(a);this.selectPath(l,this.clickedNode);this.clickedNode=l;k.onBeforeCompute(l);k.onBeforeRequest(l);this.requestNodes(l,{onComplete:function(){k.onBeforeContract(l);h.contract({onComplete:function(){j.setRightLevelToShow(l,c,k.setRightLevelToShowConfig);k.onBeforeMove(l);h.move(l,{Move:k.Move,onComplete:function(){k.onBeforeExpand(l);h.expand(l,{onComplete:function(){h.busy=false;k.onAfterCompute(a);k.onComplete()}})}})}})}})}}})}();
$jit.ST.$extend=true;$jit.ST.Op=new m({Implements:n.Op});$jit.ST.Group=new m({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config;this.animation=new A;this.nodes=null},requestNodes:function(a,c){var b=0,d=a.length,e=this.viz;if(d==0)c.onComplete();for(var g=0;g<d;g++)c.request(a[g].id,a[g]._level,{onComplete:function(a,g){if(g&&g.children)g.id=a,e.op.sum(g,{type:"nothing"});++b==d&&(e.graph.computeLevels(e.root,0),c.onComplete())}})},contract:function(a,c){var b=this,a=this.prepare(a);
this.animation.setOptions(f.merge(c,{$animating:false,compute:function(a){a==1&&(a=0.99);b.plotStep(1-a,c,this.$animating);this.$animating="contract"},complete:function(){b.hide(a,c)}})).start()},hide:function(a,c){for(var b=0;b<a.length;b++)a[b].eachLevel(1,false,function(a){a.exist&&f.extend(a,{drawn:false,exist:false})});c.onComplete()},expand:function(a,c){var b=this;this.show(a);this.animation.setOptions(f.merge(c,{$animating:false,compute:function(a){b.plotStep(a,c,this.$animating);this.$animating=
"expand"},complete:function(){b.plotStep(void 0,c,false);c.onComplete()}})).start()},show:function(a){var c=this.config;this.prepare(a);f.each(a,function(a){if(c.multitree&&!("$orn"in a.data)){delete a.data.$orns;var d=" ";a.eachSubnode(function(a){"$orn"in a.data&&d.indexOf(a.data.$orn)<0&&a.exist&&!a.drawn&&(d+=a.data.$orn+" ")});a.data.$orns=d}a.eachLevel(0,c.levelsToShow,function(a){if(a.exist)a.drawn=true})})},prepare:function(a){return this.nodes=this.getNodesWithChildren(a)},getNodesWithChildren:function(a){var c=
[],b=this.config;a.sort(function(a,b){return(a._depth<=b._depth)-(a._depth>=b._depth)});for(var d=0;d<a.length;d++)if(a[d].anySubnode("exist")){for(var e=d+1,g=false;!g&&e<a.length;e++)if(!b.multitree||"$orn"in a[e].data)g=g||a[d].isDescendantOf(a[e].id);g||c.push(a[d])}return c},plotStep:function(a,c,b){var d=this.viz,e=this.config,g=d.canvas.getCtx(),h=this.nodes,j,i,k={};for(j=0;j<h.length;j++){i=h[j];k[i.id]=[];var l=e.multitree&&!("$orn"in i.data),m=l&&i.data.$orns;i.eachSubgraph(function(a){if(l&&
m&&m.indexOf(a.data.$orn)>0&&a.drawn)a.drawn=false,k[i.id].push(a);else if((!l||!m)&&a.drawn)a.drawn=false,k[i.id].push(a)});i.drawn=true}h.length>0&&d.fx.plot();for(j in k)f.each(k[j],function(a){a.drawn=true});for(j=0;j<h.length;j++)i=h[j],g.save(),d.fx.plotSubtree(i,c,a,b),g.restore()},getSiblings:function(a){var c={};f.each(a,function(a){var d=a.getParents();if(d.length==0)c[a.id]=[a];else{var e=[];d[0].eachSubnode(function(a){e.push(a)});c[a.id]=e}});return c}});$jit.ST.Geom=new m({Implements:n.Geom,
switchOrientation:function(a){this.config.orientation=a},dispatch:function(){var a=Array.prototype.slice.call(arguments),c=a.shift(),b=a.length,d=function(a){return typeof a=="function"?a():a};if(b==2)return c=="top"||c=="bottom"?d(a[0]):d(a[1]);else if(b==4)switch(c){case "top":return d(a[0]);case "right":return d(a[1]);case "bottom":return d(a[2]);case "left":return d(a[3])}},getSize:function(a,c){var b=a.data,d=this.config,e=d.siblingOffset,b=d.multitree&&"$orn"in b&&b.$orn||d.orientation,d=a.getData("width")+
e,e=a.getData("height")+e;return c?this.dispatch(b,d,e):this.dispatch(b,e,d)},getTreeBaseSize:function(a,c,b){var d=this.getSize(a,true),e=0,g=this;if(b(c,a))return d;if(c===0)return 0;a.eachSubnode(function(a){e+=g.getTreeBaseSize(a,c-1,b)});return(d>e?d:e)+this.config.subtreeOffset},getEdge:function(a,c,b){var d=function(b,c){return function(){return a.pos.add(new p(b,c))}},e=this.node,g=a.getData("width"),f=a.getData("height");if(c=="begin")if(e.align=="center")return this.dispatch(b,d(0,f/2),
d(-g/2,0),d(0,-f/2),d(g/2,0));else if(e.align=="left")return this.dispatch(b,d(0,f),d(0,0),d(0,0),d(g,0));else if(e.align=="right")return this.dispatch(b,d(0,0),d(-g,0),d(0,-f),d(0,0));else throw"align: not implemented";else if(c=="end")if(e.align=="center")return this.dispatch(b,d(0,-f/2),d(g/2,0),d(0,f/2),d(-g/2,0));else if(e.align=="left")return this.dispatch(b,d(0,0),d(g,0),d(0,f),d(0,0));else if(e.align=="right")return this.dispatch(b,d(0,-f),d(0,0),d(0,0),d(-g,0));else throw"align: not implemented";
},getScaledTreePosition:function(a,c){var b=this.node,d=a.getData("width"),e=a.getData("height"),g=this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,f=function(b,d){return function(){return a.pos.add(new p(b,d)).$scale(1-c)}};if(b.align=="left")return this.dispatch(g,f(0,e),f(0,0),f(0,0),f(d,0));else if(b.align=="center")return this.dispatch(g,f(0,e/2),f(-d/2,0),f(0,-e/2),f(d/2,0));else if(b.align=="right")return this.dispatch(g,f(0,0),f(-d,0),f(0,-e),f(0,0));else throw"align: not implemented";
},treeFitsInCanvas:function(a,c,b){c=c.getSize();c=this.dispatch(this.config.multitree&&"$orn"in a.data&&a.data.$orn||this.config.orientation,c.width,c.height);return this.getTreeBaseSize(a,b,function(a,b){return a===0||!b.anySubnode()})<c}});$jit.ST.Plot=new m({Implements:n.Plot,plotSubtree:function(a,c,b,d){var e=this.viz,g=e.canvas,h=e.config,b=Math.min(Math.max(0.001,b),1);if(b>=0)a.drawn=false,g=g.getCtx(),e=e.geom.getScaledTreePosition(a,b),g.translate(e.x,e.y),g.scale(b,b);this.plotTree(a,
f.merge(c,{withLabels:true,hideLabels:!!b,plotSubtree:function(){var b=h.multitree&&!("$orn"in a.data),c=b&&a.getData("orns");return!b||c.indexOf(a.getData("orn"))>-1}}),d);if(b>=0)a.drawn=true},getAlignedPos:function(a,c,b){var d=this.node;if(d.align=="center")a={x:a.x-c/2,y:a.y-b/2};else if(d.align=="left")d=this.config.orientation,a=d=="bottom"||d=="top"?{x:a.x-c/2,y:a.y}:{x:a.x,y:a.y-b/2};else if(d.align=="right")d=this.config.orientation,a=d=="bottom"||d=="top"?{x:a.x-c/2,y:a.y-b}:{x:a.x-c,y:a.y-
b/2};else throw"align: not implemented";return a},getOrientation:function(a){var c=this.config,b=c.orientation;if(c.multitree)c=a.nodeFrom,a=a.nodeTo,b="$orn"in c.data&&c.data.$orn||"$orn"in a.data&&a.data.$orn;return b}});$jit.ST.Label={};$jit.ST.Label.Native=new m({Implements:n.Label.Native,renderLabel:function(a,c){var b=a.getCtx(),d=c.pos.getc(true),e=c.getData("width"),f=c.getData("height"),d=this.viz.fx.getAlignedPos(d,e,f);b.fillText(c.name,d.x+e/2,d.y+f/2)}});$jit.ST.Label.DOM=new m({Implements:n.Label.DOM,
placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.config,f=e.Node,h=this.viz.canvas,j=c.getData("width"),i=c.getData("height"),k=h.getSize(),l=d.x*h.scaleOffsetX+h.translateOffsetX,d=d.y*h.scaleOffsetY+h.translateOffsetY;if(f.align=="center")j={x:Math.round(l-j/2+k.width/2),y:Math.round(d-i/2+k.height/2)};else if(f.align=="left")e=e.orientation,j=e=="bottom"||e=="top"?{x:Math.round(l-j/2+k.width/2),y:Math.round(d+k.height/2)}:{x:Math.round(l+k.width/2),y:Math.round(d-i/2+k.height/2)};else if(f.align==
"right")e=e.orientation,j=e=="bottom"||e=="top"?{x:Math.round(l-j/2+k.width/2),y:Math.round(d-i+k.height/2)}:{x:Math.round(l-j+k.width/2),y:Math.round(d-i/2+k.height/2)};else throw"align: not implemented";i=a.style;i.left=j.x+"px";i.top=j.y+"px";i.display=this.fitsInCanvas(j,h)?"":"none";b.onPlaceLabel(a,c)}});$jit.ST.Label.SVG=new m({Implements:[$jit.ST.Label.DOM,n.Label.SVG],initialize:function(a){this.viz=a}});$jit.ST.Label.HTML=new m({Implements:[$jit.ST.Label.DOM,n.Label.HTML],initialize:function(a){this.viz=
a}});$jit.ST.Plot.NodeTypes=new m({none:{render:f.empty,contains:f.lambda(false)},circle:{render:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.circle.render("fill",{x:d.x+b,y:d.y+b},b,c)},contains:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.circle.contains({x:d.x+b,y:d.y+b},c,b)}},square:{render:function(a,c){var b=a.getData("dim"),d=b/2,b=this.getAlignedPos(a.pos.getc(true),b,b);this.nodeHelper.square.render("fill",
{x:b.x+d,y:b.y+d},d,c)},contains:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.square.contains({x:d.x+b,y:d.y+b},c,b)}},ellipse:{render:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.ellipse.render("fill",{x:e.x+b/2,y:e.y+d/2},b,d,c)},contains:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.ellipse.contains({x:e.x+
b/2,y:e.y+d/2},c,b,d)}},rectangle:{render:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.rectangle.render("fill",{x:e.x+b/2,y:e.y+d/2},b,d,c)},contains:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.rectangle.contains({x:e.x+b/2,y:e.y+d/2},c,b,d)}}});$jit.ST.Plot.EdgeTypes=new m({none:f.empty,line:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,
e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);this.edgeHelper.line.render(h,b,c)},contains:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);return this.edgeHelper.line.contains(h,b,c,this.edge.epsilon)}},arrow:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=a.getData("dim"),h=this.viz.geom.getEdge(d,
"begin",b),b=this.viz.geom.getEdge(e,"end",b),e=a.data.$direction;this.edgeHelper.arrow.render(h,b,f,e&&e.length>1&&e[0]!=d.id,c)},contains:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);return this.edgeHelper.arrow.contains(h,b,c,this.edge.epsilon)}},"quadratic:begin":{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?
d:e,"begin",b),d=this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(b){case "left":f.quadraticCurveTo(h.x+e,h.y,d.x,d.y);break;case "right":f.quadraticCurveTo(h.x-e,h.y,d.x,d.y);break;case "top":f.quadraticCurveTo(h.x,h.y+e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(h.x,h.y-e,d.x,d.y)}f.stroke()}},"quadratic:end":{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,
"begin",b),d=this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(b){case "left":f.quadraticCurveTo(d.x-e,d.y,d.x,d.y);break;case "right":f.quadraticCurveTo(d.x+e,d.y,d.x,d.y);break;case "top":f.quadraticCurveTo(d.x,d.y-e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(d.x,d.y+e,d.x,d.y)}f.stroke()}},bezier:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth<e._depth,h=this.viz.geom.getEdge(f?d:e,"begin",b),d=
this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(h.x,h.y);switch(b){case "left":f.bezierCurveTo(h.x+e,h.y,d.x-e,d.y,d.x,d.y);break;case "right":f.bezierCurveTo(h.x-e,h.y,d.x+e,d.y,d.x,d.y);break;case "top":f.bezierCurveTo(h.x,h.y+e,d.x,d.y-e,d.x,d.y);break;case "bottom":f.bezierCurveTo(h.x,h.y-e,d.x,d.y+e,d.x,d.y)}f.stroke()}}})})();
